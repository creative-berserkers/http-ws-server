{"changed":true,"filter":false,"title":"index.js","tooltip":"/lib/index.js","value":"var WebSocketServer = require('ws').Server\nvar http = require('http')\nvar fs = require('fs')\nvar url = require('url')\nvar path = require('path')\n\nexports.Server = function bootstrap(port, dirname) {\n    var server = createServer(dirname);\n    server.listen(port);\n\n    console.log(\"http server listening on %d\", port);\n\n    this.wss = new WebSocketServer({\n        server: server\n    })\n    \n    return server\n}\n\nfunction createServer(dir) {\n    var mimeTypes = {\n        \"html\": \"text/html\",\n        \"jpeg\": \"image/jpeg\",\n        \"jpg\": \"image/jpeg\",\n        \"png\": \"image/png\",\n        \"js\": \"text/javascript\",\n        \"css\": \"text/css\"\n    };\n\n    return http.createServer(function(req, res) {\n        var uri = url.parse(req.url).pathname;\n        var unescapedUri = unescape(uri);\n        if (unescapedUri === '/') unescapedUri = 'index.html';\n        var filename = path.join(process.cwd() + dir, unescapedUri);\n        console.log('handling:' + filename);\n        var stats;\n\n        try {\n            stats = fs.lstatSync(filename); // throws if path doesn't exist\n        }\n        catch (e) {\n            res.writeHead(415, {\n                'Content-Type': 'text/plain'\n            });\n            res.write('404 Not Found\\n');\n            res.end();\n            return;\n        }\n\n\n        if (stats.isFile()) {\n            // path exists, is a file\n            var mimeType = mimeTypes[path.extname(filename).split(\".\").reverse()[0]];\n            res.writeHead(200, {\n                'Content-Type': mimeType\n            });\n\n            var fileStream = fs.createReadStream(filename);\n            fileStream.pipe(res);\n        }\n        else {\n            res.writeHead(415, {\n                'Content-Type': 'text/plain'\n            });\n            res.write('404 Not Found\\n');\n            res.end();\n            return;\n        }\n\n    })\n}","undoManager":{"mark":-1,"position":27,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":51,"column":1},"action":"insert","lines":["function createServer(dir) {","    var mimeTypes = {","        \"html\": \"text/html\",","        \"jpeg\": \"image/jpeg\",","        \"jpg\": \"image/jpeg\",","        \"png\": \"image/png\",","        \"js\": \"text/javascript\",","        \"css\": \"text/css\"","    };","","    return http.createServer(function(req, res) {","        var uri = url.parse(req.url).pathname;","        var unescapedUri = unescape(uri);","        if (unescapedUri === '/') unescapedUri = 'index.html';","        var filename = path.join(process.cwd() + dir, unescapedUri);","        console.log('handling:' + filename);","        var stats;","","        try {","            stats = fs.lstatSync(filename); // throws if path doesn't exist","        }","        catch (e) {","            res.writeHead(415, {","                'Content-Type': 'text/plain'","            });","            res.write('404 Not Found\\n');","            res.end();","            return;","        }","","","        if (stats.isFile()) {","            // path exists, is a file","            var mimeType = mimeTypes[path.extname(filename).split(\".\").reverse()[0]];","            res.writeHead(200, {","                'Content-Type': mimeType","            });","","            var fileStream = fs.createReadStream(filename);","            fileStream.pipe(res);","        }","        else {","            res.writeHead(415, {","                'Content-Type': 'text/plain'","            });","            res.write('404 Not Found\\n');","            res.end();","            return;","        }","","    })","}"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":0},"end":{"row":2,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":0},"end":{"row":3,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":0},"end":{"row":1,"column":52},"action":"insert","lines":["exports.Server = function bootstrap(port, dirname) {"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":52},"end":{"row":2,"column":0},"action":"insert","lines":["",""]},{"start":{"row":2,"column":0},"end":{"row":2,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":4},"end":{"row":3,"column":0},"action":"insert","lines":["",""]},{"start":{"row":3,"column":0},"end":{"row":3,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":4},"end":{"row":3,"column":5},"action":"insert","lines":["}"]},{"start":{"row":3,"column":0},"end":{"row":3,"column":4},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":4},"end":{"row":9,"column":6},"action":"insert","lines":["var server = createServer(dirname);","    server.listen(port);","","    console.log(\"http server listening on %d\", port);","","    this.wss = new WebSocketServer({","        server: server","    })"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":6},"end":{"row":10,"column":0},"action":"insert","lines":["",""]},{"start":{"row":10,"column":0},"end":{"row":10,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":4},"end":{"row":11,"column":0},"action":"insert","lines":["",""]},{"start":{"row":11,"column":0},"end":{"row":11,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":4},"end":{"row":11,"column":5},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":5},"end":{"row":11,"column":6},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":6},"end":{"row":11,"column":7},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":7},"end":{"row":11,"column":8},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":8},"end":{"row":11,"column":9},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":9},"end":{"row":11,"column":10},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":10},"end":{"row":11,"column":11},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":11},"end":{"row":11,"column":12},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":12},"end":{"row":11,"column":13},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":13},"end":{"row":11,"column":14},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":14},"end":{"row":11,"column":15},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":15},"end":{"row":11,"column":16},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":16},"end":{"row":11,"column":17},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":0},"end":{"row":2,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":4,"column":26},"action":"insert","lines":["var WebSocketServer = require('ws').Server","var http = require('http')","var fs = require('fs')","var url = require('url')","var path = require('path')"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":26},"end":{"row":5,"column":0},"action":"remove","lines":["",""]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":4,"column":26},"end":{"row":4,"column":26},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1424291804609}